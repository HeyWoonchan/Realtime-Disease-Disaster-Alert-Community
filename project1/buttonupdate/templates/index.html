<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>질병 및 재난 알리미</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='static/assets/favicon.ico') }}" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet" />
        <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=oa0k1d1gao"></script>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style_custom.css') }}">
    </head>
    <body>
        <div class="d-flex" id="wrapper">
            <!-- Sidebar-->
            <div class="border-end bg-white" id="sidebar-wrapper">
                <div class="sidebar-heading border-bottom bg-light">Start Bootstrap</div>
                <div class="list-group list-group-flush">
                    <a class="list-group-item list-group-item-action list-group-item-light p-3" href="#!" onclick="location.href='/'">국내</a>
                    <a class="list-group-item list-group-item-action list-group-item-light p-3" href="#!" onclick="location.href='/newspage'">국내 재난 뉴스</a>
                    <a class="list-group-item list-group-item-action list-group-item-light p-3" href="#!" onclick="location.href='/external'">해외</a>
                    <a class="list-group-item list-group-item-action list-group-item-light p-3" href="#!" onclick="location.href='/community'">커뮤니티</a>
                    <a class="list-group-item list-group-item-action list-group-item-light p-3" href="#!" onclick="location.href='/quiz'">퀴즈</a>
                </div>
            </div>
            <!-- Page content wrapper-->
            <div id="page-content-wrapper">
                <!-- Top navigation-->
                <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
                    <div class="container-fluid">
                        <button class="btn btn-primary" id="sidebarToggle">Toggle Menu</button>
                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav ms-auto mt-2 mt-lg-0">
                                <li class="nav-item active"><a class="nav-link" href="#!">Home</a></li>
                                <li class="nav-item"><a class="nav-link" href="#!">Link</a></li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Dropdown</a>
                                    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                                        <a class="dropdown-item" href="#!">Action</a>
                                        <a class="dropdown-item" href="#!">Another action</a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item" href="#!">Something else here</a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </nav>
                <!-- Page content-->
                <div class="container-fluid">
                    <h1 class="mt-4">국내 정보</h1>
                    <hr>
                    <div class="container">
                        <div class="row">
                            <div class="col-sm-12 col-md-6">
                                <div class="card" style="height:800px;">
                                  <div id="map" class="card-body">
                                    <!-- Map will be placed here. -->
                                  </div>
                                </div>
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">댓글 목록</h5>
                                        {% for comment in comments %}
                                        <li>{{ comment[1] }}: {{ comment[2] }}</li>
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-body">
                                        <form method="POST" action="/">
                                            <input type="text" name="name" placeholder="이름"><br>
                                            <textarea name="comment" placeholder="댓글"></textarea><br>
                                            <input type="submit" value="등록">
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-6">
                                <!-- 여기에 두 번째 요소의 내용을 넣습니다. -->
                                {% for row in data_emerg %}
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">[ 긴급/재난 ] {{ row[1] }} {{ row[0] }}</h5>
                                        <p class="card-text">{{ row[2] }}</p>
                                    </div>
                                </div>
                                {% endfor %}
                                <hr>

                                {% for row in data %}
                                    <div class="card" id="1" onclick="moveToLocation(this.id)">
                                        <div class="card-body">
                                            <h5 class="card-title">
                                                {% if row[3] == "missing" %}
                                                    실종
                                                {% elif row[3] == "disaster" %}
                                                    재난
                                                {% elif row[3] == "emergency" %}
                                                    긴급
                                                {% else %}
                                                    {{ row[3] }}
                                                {% endif %}
                                                {{ row[1] }} {{ row[0] }}
                                            </h5>
                                            <p class="card-text">{{ row[2] }}</p>
                                        </div>
                                    </div>
                                {% endfor %}
                                <hr>
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">연합뉴스속보</h5>
                                        <p class="card-text">{{ yh_news | safe}}</p>
                                        <h5 class="card-title">네이버뉴스 속보 검색결과</h5>
                                        <p class="card-text">{{ nv_news }}</p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <a href="/external" class="text-decoration-none text-dark">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h5 class="card-title">해외정보 페이지</h5>
                                                    <p class="card-text">클릭하시면 해외정보 페이지로 넘어갑니다.</p>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <div class="col-6">
                                        <a href="/community" class="text-decoration-none text-dark">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h5 class="card-title">커뮤니티 페이지</h5>
                                                    <p class="card-text">클릭하시면 커뮤니티 페이지로 넘어갑니다.</p>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">빈자리 채우기</h5>
                                        <p class="card-text">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec consequat ultrices tellus, ut lobortis nisi maximus at. Nulla facilisi. Sed ultrices eleifend metus ac vestibulum. Integer euismod sem vitae volutpat sagittis. Fusce id malesuada odio, sed interdum nisl. Maecenas varius ex eu mauris tempus, id feugiat erat gravida. Phasellus pellentesque, metus nec interdum aliquet, neque ex eleifend tortor, eget convallis lectus turpis non lorem. Vestibulum a lectus massa. Mauris sed risus non orci sollicitudin feugiat. Nullam bibendum hendrerit nunc ac tincidunt.</p>
                                    </div>
                                </div>
                          </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12 col-md-12">
                                <div class="card">
                                    <div class="card-body">
                                        <canvas id="myChart" style="width:100%;"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                      </div>
                    <hr>
                    
                </div>
            </div>
        </div>
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>

        <script src="{{ url_for('static', filename='js/button_update.js') }}"></script>

        <script src="{{ url_for('static', filename='js/maps_in.js') }}"></script>

        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCnp17nNrPOjhrQk4Pp7HUVfMGzyqGw5eI&callback=initMap" async defer > </script>
        <script>
            var chartData = {{ chart_data|tojson }}; // 오류 아님
            var dates = {{ dates|tojson }};

            var types = Object.keys(chartData[dates[0]]);

            var datasets = [];
            types.forEach(function(type) {
                var data = [];
                dates.forEach(function(date) {
                    data.push(chartData[date][type]);
                });

                var dataset = {
                    label: type,
                    data: data,
                    backgroundColor: getRandomColor()
                };
                datasets.push(dataset);
            });

            var ctx = document.getElementById('myChart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: datasets
                },
                options: {
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true
                        }
                    }
                }
            });

            function getRandomColor() {
                var letters = '0123456789ABCDEF';
                var color = '#';
                for (var i = 0; i < 6; i++) {
                    color += letters[Math.floor(Math.random() * 16)];
                }
                return color;
            }
            window.addEventListener('resize', () => {
                myChart.resize();
            });    
        </script>
    </body>
</html>